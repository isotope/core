Isotope.zoomGallery=function(a,c,b){if(typeof a!="undefined"){a.destroy()}return new ZoomIt(Object.merge({elems:".zoomImage",imgSrc:c,multiplier:1.4,zoomPosition:"right"},b))};var ZoomIt=new Class({Implements:[Events,Options],options:{container:null,elems:".zoomIt",imgSrc:"",mouseEvent:"mouseenter",multiplier:1,zoomPosition:"bottom",zoomDistance:10,zoomClass:"zoomIt_zoomed",zoomLoadingClass:"zoomIt_loading",zoomAreaClass:"zoomIt_area",zoomAreaColor:"#FFF",zoomAreaOpacity:0.5,zoomAreaMove:"mousemove"},initialize:function(a){this.setOptions(a);if(!this.options.elems){return}this.elements=$(this.options.container||document.body).getElements(this.options.elems);this.zoomerVisible=false;this.current=-1;this.zoomer=new Element("div",{id:"MooZoom_zoomer","class":this.options.zoomClass,styles:{display:"block",position:"absolute",top:-1000,overflow:"hidden"}}).injectInside(document.body);this.elements.each(function(g,e){var h={};h.bigImgURL=this.options.imgSrc;var f=g.getElement("img").getSize();h.imgSize=f;var d=g.getPosition(),c=g.getSize();h.position={x:d.x,y:d.y};switch(this.options.zoomPosition){case"right":default:d.x+=c.x+this.options.zoomDistance;break;case"left":d.x-=f.x*(this.options.multiplier||1)+this.options.zoomDistance;break;case"bottom":d.y+=c.y+this.options.zoomDistance;break;case"top":d.y-=f.y*(this.options.multiplier||1)+this.options.zoomDistance;break}h.zoomPosition=d;var b=new Element("div",{"class":this.options.zoomAreaClass,styles:{background:this.options.zoomAreaColor||"#999",opacity:this.options.zoomAreaOpacity||0.7,display:"none",position:"absolute",top:0,left:0,cursor:"move"}}).injectInside(g.getParent());h.dragged=b;g.store("params",h);g.addEvent(this.options.mouseEvent||"mouseenter",function(i){i.preventDefault();this.startZoom(e)}.bind(this));g.getParent().addEvent("mouseleave",this.closeZoom.bind(this))}.bind(this))},startZoom:function(h){if(this.zoomerVisible){return}this.zoomerVisible=true;this.current=h;var i=this.elements[h],a=i.retrieve("params"),j=a.imgSize,c=a.bigImgURL,f=a.dragged,d=i.retrieve("dragParams"),k=0,b=0;if(d&&d.fullImageSize){k=d.fullImageSize.x;b=d.fullImageSize.y}else{k=j.x*(this.options.multiplier||1);b=j.y*(this.options.multiplier||1)}this.zoomer.empty().setStyles({width:k,height:b}).setPosition(a.zoomPosition);if(d){d.bigImg.injectInside(this.zoomer);f.setStyles({display:"block",width:d.dragW,height:d.dragH});this.fireEvent("onZoom",i);return}this.zoomer.addClass(this.options.zoomLoadingClass);var g=Asset.image(c,{onLoad:function(p){this.zoomer.removeClass(this.options.zoomLoadingClass);g.setStyles({position:"absolute",top:0,left:0}).injectInside(this.zoomer);var o=g.getSize(),l=o.x/j.x,t=o.y/j.y,r=j.x/l*(this.options.multiplier||1),n=j.y/t*(this.options.multiplier||1);if(this.options.multiplier>l&&this.options.multiplier>t){this.zoomer.setStyles({width:o.x,height:o.y});var q={};q.bigImg=g;q.fullImageSize=o;this.elements[h].store("dragParams",q);return}f.setStyles({display:"block",width:r,height:n});var m=f.getPosition(f.getParent());g.setStyles({top:-(m.y*t),left:-(m.x*l)});var q={};q.bigImg=g;q.dragW=r;q.dragH=n;this.elements[h].store("dragParams",q);if(this.options.zoomAreaMove=="mousemove"){this.elements[h].addEvent("mousemove",function(u){var s=u.page.x-a.position.x-r/2,e=u.page.y-a.position.y-n/2;if(u.page.x>(a.position.x+a.imgSize.x-r/2)){s=a.imgSize.x-r}if(u.page.y>(a.position.y+a.imgSize.y-n/2)){e=a.imgSize.y-n}f.setPosition({x:s,y:e})}.bind(this));f.addEvent("mousemove",function(e){var w=e.page.x-a.position.x-r/2,s=e.page.y-a.position.y-n/2;if(e.page.x<a.position.x+r/2){w=0}if(e.page.y<a.position.y+n/2){s=0}if(e.page.x>(a.position.x+a.imgSize.x-r/2)){w=a.imgSize.x-r}if(e.page.y>(a.position.y+a.imgSize.y-n/2)){s=a.imgSize.y-n}f.setPosition({x:w,y:s});var x=f.getPosition(f.getParent()),v=-(x.x*l),u=-(x.y*t);g.setPosition({x:v,y:u})})}else{new Drag(f,{modifiers:{x:"left",y:"top"},grid:1,limit:{x:[0,(j.x-r)],y:[0,(j.y-n)]},onDrag:function(e){var v=e.getPosition(e.getParent()),u=-(v.x*l),s=-(v.y*t);g.setPosition({x:u,y:s})}.bind(this)})}this.fireEvent("onZoom",p)}.bind(this)})},closeZoom:function(b){if(this.current==-1){return}var c=this.elements[this.current],a=c.retrieve("params").dragged.setStyle("display","none");this.zoomer.setStyles({top:-1000}).empty();this.current=-1;this.zoomerVisible=false;this.fireEvent("onClose",c)},destroy:function(){this.elements.each(function(b){var a=b.retrieve("params");b.setProperty("href",a.bigImgURL);a.dragged.dispose();b.eliminate("params").eliminate("dragParams");b.removeEvents();b.getParent().removeEvents()});this.zoomer.dispose()}});