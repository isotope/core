var Isotope={};!function(){"use strict";Isotope.toggleCheckboxGroup=function(e,t){var n=document.id(e).className,o=document.id(e).checked?"checked":"";"tl_checkbox"==n?$$("#"+t+" .tl_checkbox").each(function(e){e.disabled||(e.checked=o)}):"tl_tree_checkbox"==n&&$$("#"+t+" .parent .tl_tree_checkbox").each(function(e){e.disabled||(e.checked=o)}),Backend.getScrollOffset()},Isotope.openModalGroupSelector=function(e){var t=e||{},n=(window.getSize().y-180).toInt();(!t.height||t.height>n)&&(t.height=n);var o=new SimpleModal({width:t.width,btn_ok:Contao.lang.close,draggable:!1,overlayOpacity:.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});return o.addButton(Contao.lang.close,"btn",function(){this.hide()}),o.addButton(Contao.lang.apply,"btn primary",function(){for(var e=[],n=null,o=window.frames,a=0;a<o.length;a++)if("simple-modal-iframe"==o[a].name){n=o[a];break}if(null===n)return void alert("Could not find the SimpleModal frame");var i=n.document.getElementById("tl_listing");i||(i=n.document.getElementById("tl_select"));for(var l=i.getElementsByTagName("input"),a=0;a<l.length;a++)l[a].checked&&!l[a].id.match(/^check_all_/)&&(l[a].id.match(/^reset_/)||e.push(l[a].get("value")));new Request.Contao({evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(e,t){""!=e&&(window.location.href=e)},onFailure:function(e){[302,303,307].indexOf(e.status)>-1&&""!=e.responseText&&(window.location.href=e.responseText)}}).post({action:t.action,value:e[0],redirect:t.redirect,REQUEST_TOKEN:Contao.request_token}),this.hide(),t.trigger&&t.trigger.fireEvent("closeModal")}),o.show({title:t.title,contents:'<iframe src="'+t.url+'" name="simple-modal-iframe" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"}),o},Isotope.openModalPageSelector=function(e){var t=e||{},n=(window.getSize().y-180).toInt();(!t.height||t.height>n)&&(t.height=n);var o=new SimpleModal({width:t.width,btn_ok:Contao.lang.close,draggable:!1,overlayOpacity:.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});return o.addButton(Contao.lang.close,"btn",function(){this.hide()}),o.addButton(Contao.lang.apply,"btn primary",function(){for(var e=0,n=null,o=window.frames,a=0;a<o.length;a++)if("simple-modal-iframe"==o[a].name){n=o[a];break}if(null===n)return void alert("Could not find the SimpleModal frame");var i=n.document.getElementById("tl_listing");i||(i=n.document.getElementById("tl_select"));for(var l=i.getElementsByTagName("input"),a=0;a<l.length;a++)l[a].checked&&!l[a].id.match(/^check_all_/)&&(l[a].id.match(/^reset_/)||(e=l[a].get("value")));new Request.Contao({evalScripts:!1,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(e,t){""!=e&&(window.location.href=e)},onFailure:function(e){[302,303,307].indexOf(e.status)>-1&&""!=e.responseText&&(window.location.href=e.responseText)}}).post({action:t.action,value:e,redirect:t.redirect,REQUEST_TOKEN:Contao.request_token}),this.hide()}),o.show({title:t.title,contents:'<iframe src="'+t.url+'" name="simple-modal-iframe" width="100%" height="'+t.height+'" frameborder="0"></iframe>',model:"modal"}),o},Isotope.addInteractiveHelp=function(){new Tips.Contao("a.tl_tip",{offset:{x:9,y:21},text:function(e){return e.get("longdesc")}})},Isotope.inheritFields=function(e,t){var n=!1;e.each(function(e,o){var a=document.id("ctrl_"+e);if(a){a.removeProperty("required");var i=a.getParent("div").getFirst("h3");if(!i&&a.match(".tl_checkbox_single_container")&&(i=a),!i)return void(n=!0);i.addClass("inherit");var l=document.id("ctrl_inherit").getFirst("input[value="+e+"]");if(l.setStyle("float","right").inject(i),document.id("ctrl_inherit").getFirst("label[for="+l.get("id")+"]").setStyles({"float":"right","padding-right":"5px","font-weight":"normal"}).set("text",t).inject(i),l.addEvent("change",function(e){var t=document.id("ctrl_"+e.target.get("value"));if(t.match(".tl_checkbox_single_container"))t.getFirst("input[type=checkbox]").disabled=e.target.checked;else{t.getPrevious()&&t.getPrevious().hasClass("mce-tinymce")?t.getPrevious().setStyle("display",e.target.checked?"none":null):t.setStyle("display",e.target.checked?"none":null);try{t.getAllNext(":not(script)").setStyle("display",e.target.checked?"none":null)}catch(n){}}}),a.match(".tl_checkbox_single_container"))a.getFirst("input[type=checkbox]").disabled=l.checked;else{a.setStyle("display",l.checked?"none":null);try{a.getAllNext(":not(script)").setStyle("display",l.checked?"none":null)}catch(r){}}}}),n||document.id("ctrl_inherit").getParent("div").setStyle("display","none")},Isotope.makeSelectExtendable=function(){var e={};document.getElements("select.extendable").forEach(function(t){var n=t.value,o=t.getParent("table").id;e[o]=e[o]||[],e[o].push(t),t.grab(new Element("option",{text:"Add …",value:"extendSelect"})).addEvent("change",function(a){if("extendSelect"==t.value){var i=prompt("Please enter the new group name.");""!=i?(o&&e[o]?e[o].forEach(function(e){new Element("option",{text:i,value:i}).inject(e.getLast(),"before")}):new Element("option",{text:i,value:i}).inject(t.getLast(),"before"),t.value=i,n=i):t.value=n,t.fireEvent("change")}else n=t.value})})},Isotope.makeParentViewSortable=function(e){var t=new Scroller(document.getElement("body"),{onChange:function(e,t){this.element.scrollTo(this.element.getScroll().x,t)}}),n=new Sortables(e,{contstrain:!0,opacity:.6,onStart:function(){t.start()},onComplete:function(){t.stop()},onSort:function(e){var t,n,o,a=e.getFirst("div");a&&(a.hasClass("wrapper_start")?((t=e.getPrevious("li"))&&(o=t.getFirst("div"))&&o.removeClass("indent"),(n=e.getNext("li"))&&(o=n.getFirst("div"))&&o.addClass("indent")):a.hasClass("wrapper_stop")?((t=e.getPrevious("li"))&&(o=t.getFirst("div"))&&o.addClass("indent"),(n=e.getNext("li"))&&(o=n.getFirst("div"))&&o.removeClass("indent")):a.hasClass("indent")?(t=e.getPrevious("li"))&&(o=t.getFirst("div"))&&o.hasClass("wrapper_stop")?a.removeClass("indent"):(n=e.getNext("li"))&&(o=n.getFirst("div"))&&o.hasClass("wrapper_start")&&a.removeClass("indent"):(t=e.getPrevious("li"))&&(o=t.getFirst("div"))&&o.hasClass("wrapper_start")?a.addClass("indent"):(n=e.getNext("li"))&&(o=n.getFirst("div"))&&o.hasClass("wrapper_stop")&&a.addClass("indent"))},handle:".drag-handle"});n.active=!1,n.addEvent("start",function(){n.active=!0}),n.addEvent("complete",function(e){if(n.active){var t,o,a,i;e.getPrevious("li")?(t=e.get("id").replace(/li_/,""),o=e.getPrevious("li").get("id").replace(/li_/,""),a=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=1&page_id="+o,i=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:i+a,followRedirects:!1}).get()):e.getParent("ul")&&(t=e.get("id").replace(/li_/,""),o=e.getParent("ul").get("id").replace(/ul_/,""),a=window.location.search.replace(/id=[0-9]*/,"id="+t)+"&act=cut&mode=2&page_id="+o,i=window.location.href.replace(/\?.*$/,""),new Request.Contao({url:i+a,followRedirects:!1}).get())}})}}(),Isotope.MediaManager={},function(){"use strict";Isotope.MediaManager.init=function(e,t,n){var o,a,i,l,r,d,s=$("ctrl_"+t),c=[],u={element:document.id(e),request:{endpoint:window.location.href,inputName:t,params:{action:"uploadMediaManager",name:t,REQUEST_TOKEN:Contao.request_token}},failedUploadTextDisplay:{mode:"custom",maxChars:50,responseProperty:"error"},validation:{allowedExtensions:n},callbacks:{onUpload:function(){AjaxRequest.displayBox(Contao.lang.loading+" …")},onComplete:function(e,n,u){if(!u.success)return void AjaxRequest.hideBox();if(u.file&&c.push(u.file),!(this.getInProgress()>0)){for(d={},l=s.getElements('[name^="'+t+'"]'),a=0;a<l.length;a++)o=l[a].get("name").split("["),3==o.length&&(i=o[1].replace("]",""),d[i]||(d[i]={}),r=o[2].replace("]",""),"radio"==l[a].get("type")?(d[i][r]||(d[i][r]=""),l[a].get("checked")&&(d[i][r]=l[a].get("value"))):d[i][r]=l[a].get("value"));new Request.Contao({evalScripts:!1,onSuccess:function(e,t){s.getElement("div").set("html",t.content),t.javascript&&Browser.exec(t.javascript),AjaxRequest.hideBox(),window.fireEvent("ajax_change")}}).post({action:"reloadMediaManager",name:t,value:d,files:c,REQUEST_TOKEN:Contao.request_token}),c=[]}}}};return new qq.FineUploader(u)},Isotope.MediaManager.makeSortable=function(){$$(".tl_mediamanager .sortable").each(function(e){new Sortables(e,{contstrain:!0,opacity:.6,handle:".drag-handle",onComplete:function(){Isotope.MediaManager.resort(e)}})})},Isotope.MediaManager.act=function(e,t,n){var o=document.id(n).getElement("table"),a=o.getFirst("tbody"),i=document.id(e).getParent("tr");a.getChildren();switch(Backend.getScrollOffset(),t){case"up":i.getPrevious()?i.injectBefore(i.getPrevious()):i.injectInside(a);break;case"down":i.getNext()?i.injectAfter(i.getNext()):i.injectBefore(a.getFirst());break;case"delete":i.destroy()}Isotope.MediaManager.resort(a)},Isotope.MediaManager.resort=function(e){var t,n,o,a,i=e.getChildren();for(o=0;o<i.length;o++){for(t=i[o].getElements("[name]"),a=0;a<t.length;a++)t[a].name=t[a].name.replace(/\[[0-9]+\]/g,"["+o+"]"),t[a].id=t[a].id.replace(/_[0-9]+/g,"_"+o);for(n=i[o].getElements("label"),a=0;a<n.length;a++)n[a].set("for",n[a].get("for").replace(/_[0-9]+/g,"_"+o))}}}(),window.addEvent("domready",function(){Isotope.addInteractiveHelp(),Isotope.makeSelectExtendable(),Isotope.MediaManager.makeSortable()}).addEvent("structure",function(){Isotope.addInteractiveHelp()}),window.addEvent("ajax_change",function(){Isotope.addInteractiveHelp(),Isotope.MediaManager.makeSortable()});
